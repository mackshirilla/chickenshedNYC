"use strict";(()=>{function U(){let e=localStorage.getItem("authToken");return e?fetch("https://x8ki-letl-twmt.n7.xano.io/api:WyQO-hFi/auth/me",{method:"GET",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}}).then(t=>{if(!t.ok)throw new Error("Network response was not ok");return t.json()}).catch(t=>{console.error("Error:",t);let n=document.querySelector(".page-wrapper");n&&n.hasAttribute("gatedContent")&&(window.location.href="/login",localStorage.removeItem("authToken"),localStorage.removeItem("profile"),localStorage.removeItem("role"))}):(window.location.href="/login",Promise.reject())}function F(e){e.addEventListener("change",async()=>{var H;let t=document.getElementById("profileImage"),n=document.getElementById("fileError"),o=document.getElementById("fileUploaded"),B=document.getElementById("loadingImageAnimation"),m=(H=e.files)==null?void 0:H[0];if(m){if(m.size>2*1024*1024){n.textContent="File size must be less than 2MB",n.style.display="block";return}let d=new FileReader;d.onload=async()=>{t.src=d.result,n.textContent="",n.style.display="none",B.style.display="flex";try{let u=localStorage.getItem("profile"),l=u?JSON.parse(u):null,k=l?l.id:null,s=await fetch("https://x8ki-letl-twmt.n7.xano.io/api:2gnTJ2I8/guardianImages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({guardianID:k,guardianImage:d.result})});if(s.ok)o.style.display="block";else throw new Error(`Error: ${s.status} ${s.statusText}`)}catch(u){n.textContent=u.message,n.style.display="block"}finally{B.style.display="none"}},d.readAsDataURL(m)}else t.src="https://assets.website-files.com/64404db37a2b832b7d5aa9f8/64404db37a2b831d465aaa01_image.svg",n.textContent="",n.style.display="none"})}var g=document.getElementById("firstNameInput"),C=document.getElementById("firstNameError");function K(){return g.hasAttribute("required")&&g.value.trim()===""?(C.textContent="First name required",C.style.display="block",g.classList.add("error"),!1):(C.textContent="",C.style.display="none",g.classList.remove("error"),!0)}g&&g.addEventListener("blur",K);var I=document.getElementById("lastNameInput"),N=document.getElementById("lastNameError");function V(){return I.hasAttribute("required")&&I.value.trim()===""?(N.textContent="Last name required",N.style.display="block",I.classList.add("error"),!1):(N.textContent="",N.style.display="none",I.classList.remove("error"),!0)}I&&I.addEventListener("blur",V);var a=document.getElementById("emailInput"),c=document.getElementById("emailError");function X(){let e=/^\S+@\S+\.\S+$/;return a.hasAttribute("required")&&a.value.trim()===""?(c.textContent="Email is required",c.style.display="block",a.classList.add("error"),!1):a.value.trim()!==""&&!e.test(a.value)?(c.textContent="Please enter a valid email",c.style.display="block",a.classList.add("error"),!1):(c.textContent="",c.style.display="none",a.classList.remove("error"),!0)}a&&a.addEventListener("blur",X);var r=document.getElementById("phoneInput"),p=document.getElementById("phoneError");function z(e){let t=e.replace(/\D/g,"");return t.length===0?"":t.length<4?`(${t}`:t.length<7?`(${t.slice(0,3)}) ${t.slice(3)}`:`(${t.slice(0,3)}) ${t.slice(3,6)}-${t.slice(6,10)}`}function O(){let e=/^\D*(\d{3})\D*\D*(\d{3})\D*(\d{4})\D*$/;return r.required&&r.value.trim()===""?(p.textContent="Phone is required",p.style.display="block",r.classList.add("error"),!1):r.value.trim()!==""&&!e.test(r.value)?(p.textContent="Please enter a valid phone number",p.style.display="block",r.classList.add("error"),!1):(r.value=z(r.value),p.textContent="",p.style.display="none",r.classList.remove("error"),!0)}r&&r.addEventListener("input",e=>{let t=e.target;t.value=z(t.value),O()});var f=document.getElementById("dobInput"),D=document.getElementById("dobError");function Z(){return f.hasAttribute("required")&&f.value.trim()===""?(D.textContent="Date of Birth is required",D.style.display="block",f.classList.add("error"),!1):(D.textContent="",D.style.display="none",f.classList.remove("error"),!0)}f&&f.addEventListener("blur",Z);var h=document.getElementById("genderInput"),S=document.getElementById("genderError");function ee(){return h.hasAttribute("required")&&h.value.trim()===""?(S.textContent="Gender is required",S.style.display="block",h.classList.add("error"),!1):(S.textContent="",S.style.display="none",h.classList.remove("error"),!0)}h&&h.addEventListener("blur",ee);var b=document.getElementById("schoolInput"),w=document.getElementById("schoolError");function te(){return b.hasAttribute("required")&&b.value.trim()===""?(w.textContent="School name is required",w.style.display="block",b.classList.add("error"),!1):(w.textContent="",w.style.display="none",b.classList.remove("error"),!0)}b&&b.addEventListener("blur",te);var L=document.getElementById("gradeInput"),q=document.getElementById("gradeError");function ne(){return L.hasAttribute("required")&&L.value.trim()==="N/A"?(q.textContent="Grade is required",q.style.display="block",L.classList.add("error"),!1):(q.textContent="",q.style.display="none",L.classList.remove("error"),!0)}L&&L.addEventListener("blur",ne);var R=document.getElementById("ethnicityInput"),E=document.getElementById("ethnicityError");function re(){return R.hasAttribute("required")&&R.value.trim()===""?(E.textContent="Ethnicity is required",E.style.display="block",R.classList.add("error"),!1):(E.textContent="",E.style.display="none",E.classList.remove("error"),!0)}E&&R.addEventListener("blur",re);var v=document.getElementById("healthInput"),A=document.getElementById("healthError");function se(){return v.hasAttribute("required")&&v.value.trim()===""?(A.textContent="This field is required",A.style.display="block",v.classList.add("error"),!1):(A.textContent="",A.style.display="none",v.classList.remove("error"),!0)}v&&v.addEventListener("blur",se);var T=document.getElementById("emergencyContact"),P=document.getElementById("emergencyError");function oe(){return T.hasAttribute("required")&&T.value.trim()===""?(P.textContent="This field is required",P.style.display="block",T.classList.add("error"),!1):(P.textContent="",P.style.display="none",T.classList.remove("error"),!0)}T&&T.addEventListener("blur",oe);var x=document.getElementById("dismissal"),G=document.getElementById("dismissalError");function ae(){return x.hasAttribute("required")&&x.value.trim()===""?(G.textContent="This field is required",G.style.display="block",x.classList.add("error"),!1):(G.textContent="",G.style.display="none",x.classList.remove("error"),!0)}x&&x.addEventListener("blur",ae);var i=document.getElementById("additionalEmail"),y=document.getElementById("additionalEmailError");function ie(){let e=/^\S+@\S+\.\S+$/;return i.hasAttribute("required")&&i.value.trim()===""?(y.textContent="Email is required",y.style.display="block",i.classList.add("error"),!1):i.value.trim()!==""&&!e.test(i.value)?(y.textContent="Please enter a valid email",y.style.display="block",i.classList.add("error"),!1):(y.textContent="",y.style.display="none",i.classList.remove("error"),!0)}i&&i.addEventListener("blur",ie);var M=document.getElementById("interestInput"),$=document.getElementById("interestError");function le(){return M.hasAttribute("required")&&M.value.trim()===""?($.textContent="This field is required",$.style.display="block",M.classList.add("error"),!1):($.textContent="",$.style.display="none",M.classList.remove("error"),!0)}M&&M.addEventListener("blur",le);async function Y(){let e=localStorage.getItem("profile"),t=e?JSON.parse(e):null,n=t?t.id:null;if(!n)return;let o=document.getElementById("loadingAnimation"),B=document.getElementById("phoneInput"),m=document.getElementById("sendTexts"),H=document.getElementById("yMember"),d=document.getElementById("membershipNumber");if(o&&B&&m&&H&&d){o.style.display="block";let u={phone:B.value,sendTexts:m.checked,isYMember:H.checked,membershipNumber:d.value,guardianID:n};try{let l=await fetch(`https://x8ki-letl-twmt.n7.xano.io/api:2gnTJ2I8/guardians/${n}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u)});if(l.ok){let k=await l.json();localStorage.setItem("profile",JSON.stringify(k));let s=localStorage.getItem("redirectURL");s?(localStorage.removeItem("redirectURL"),window.location.href=s):window.location.href="/create-account/step-2"}else{let k=await l.json(),s=document.getElementById("submitError");s&&(s.style.display="block",s.textContent=k.message),o&&(o.style.display="none")}}catch(l){console.error(l)}finally{o&&(o.style.display="none")}}}U();var de=localStorage.getItem("redirectURL"),j=document.getElementById("progressBar");!de&&j?j.style.display="none":j&&(j.style.display="block");localStorage.removeItem("studentID");var me=document.getElementById("imageUpload");F(me);var _=document.getElementById("phoneInput");_&&_.addEventListener("input",O);var J=document.getElementById("yMember"),W=document.getElementById("displayYInput");J.addEventListener("change",()=>{J.checked?setTimeout(()=>{W.style.height="6.5rem"},0):W.style.height="0rem"});var Q=document.getElementById("sendTexts");Q.addEventListener("change",()=>{let e=document.getElementById("textsToggleText");Q.checked?e.textContent="Yes":e.textContent="No"});J.addEventListener("change",()=>{let e=document.getElementById("yMemberToggleText");J.checked?e.textContent="Yes":e.textContent="No"});var ue=document.getElementById("submitButton");ue.addEventListener("click",e=>{if(O())e.preventDefault(),Y();else{e.preventDefault();let t=document.getElementById("submitError");t.style.display="block",t.textContent="Please make sure you have entered all fields correctly."}});})();
