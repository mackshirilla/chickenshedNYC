"use strict";(()=>{function ne(){let e=localStorage.getItem("authToken");return e?fetch("https://x8ki-letl-twmt.n7.xano.io/api:WyQO-hFi/auth/me",{method:"GET",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}}).then(t=>{if(!t.ok)throw new Error("Network response was not ok");return t.json()}).catch(t=>{console.error("Error:",t);let a=document.querySelector(".page-wrapper");a&&a.hasAttribute("gatedContent")&&(window.location.href="/login",localStorage.removeItem("authToken"),localStorage.removeItem("profile"),localStorage.removeItem("role"))}):(window.location.href="/login",Promise.reject())}function ae(e){e.addEventListener("change",async()=>{var i;let t=document.getElementById("profileImage"),a=document.getElementById("fileError"),s=document.getElementById("fileUploaded"),c=document.getElementById("loadingImageAnimation"),o=(i=e.files)==null?void 0:i[0];if(o){if(o.size>2*1024*1024){a.textContent="File size must be less than 2MB",a.style.display="block";return}let n=new FileReader;n.onload=async()=>{t.src=n.result,a.textContent="",a.style.display="none",c.style.display="flex";try{let l=localStorage.getItem("studentID"),r=await fetch("https://x8ki-letl-twmt.n7.xano.io/api:2gnTJ2I8/studentImages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({studentID:l,studentImage:n.result})});if(r.ok)s.style.display="block";else throw new Error(`Error: ${r.status} ${r.statusText}`)}catch(l){a.textContent=l.message,a.style.display="block"}finally{c.style.display="none"}},n.readAsDataURL(o)}else t.src="https://assets.website-files.com/64404db37a2b832b7d5aa9f8/64404db37a2b831d465aaa01_image.svg",a.textContent="",a.style.display="none"})}var h=document.getElementById("firstNameInput"),N=document.getElementById("firstNameError");function U(){return h.hasAttribute("required")&&h.value.trim()===""?(N.textContent="First name required",N.style.display="block",h.classList.add("error"),!1):(N.textContent="",N.style.display="none",h.classList.remove("error"),!0)}h&&h.addEventListener("blur",U);var L=document.getElementById("lastNameInput"),S=document.getElementById("lastNameError");function J(){return L.hasAttribute("required")&&L.value.trim()===""?(S.textContent="Last name required",S.style.display="block",L.classList.add("error"),!1):(S.textContent="",S.style.display="none",L.classList.remove("error"),!0)}L&&L.addEventListener("blur",J);var m=document.getElementById("emailInput"),g=document.getElementById("emailError");function F(){let e=/^\S+@\S+\.\S+$/;return m.hasAttribute("required")&&m.value.trim()===""?(g.textContent="Email is required",g.style.display="block",m.classList.add("error"),!1):m.value.trim()!==""&&!e.test(m.value)?(g.textContent="Please enter a valid email",g.style.display="block",m.classList.add("error"),!1):(g.textContent="",g.style.display="none",m.classList.remove("error"),!0)}m&&m.addEventListener("blur",F);var d=document.getElementById("phoneInput"),y=document.getElementById("phoneError");function le(e){let t=e.replace(/\D/g,"");return t.length===0?"":t.length<4?`(${t}`:t.length<7?`(${t.slice(0,3)}) ${t.slice(3)}`:`(${t.slice(0,3)}) ${t.slice(3,6)}-${t.slice(6,10)}`}function G(){let e=/^\D*(\d{3})\D*\D*(\d{3})\D*(\d{4})\D*$/;return d.required&&d.value.trim()===""?(y.textContent="Phone is required",y.style.display="block",d.classList.add("error"),!1):d.value.trim()!==""&&!e.test(d.value)?(y.textContent="Please enter a valid phone number",y.style.display="block",d.classList.add("error"),!1):(d.value=le(d.value),y.textContent="",y.style.display="none",d.classList.remove("error"),!0)}d&&d.addEventListener("input",e=>{let t=e.target;t.value=le(t.value),G()});var v=document.getElementById("dobInput"),k=document.getElementById("dobError");function _(){return v.hasAttribute("required")&&v.value.trim()===""?(k.textContent="Date of Birth is required",k.style.display="block",v.classList.add("error"),!1):(k.textContent="",k.style.display="none",v.classList.remove("error"),!0)}v&&v.addEventListener("blur",_);var T=document.getElementById("genderInput"),w=document.getElementById("genderError");function z(){return T.hasAttribute("required")&&T.value.trim()===""?(w.textContent="Gender is required",w.style.display="block",T.classList.add("error"),!1):(w.textContent="",w.style.display="none",T.classList.remove("error"),!0)}T&&T.addEventListener("blur",z);var b=document.getElementById("schoolInput"),A=document.getElementById("schoolError");function W(){return b.hasAttribute("required")&&b.value.trim()===""?(A.textContent="School name is required",A.style.display="block",b.classList.add("error"),!1):(A.textContent="",A.style.display="none",b.classList.remove("error"),!0)}b&&b.addEventListener("blur",W);var M=document.getElementById("gradeInput"),q=document.getElementById("gradeError");function V(){return M.hasAttribute("required")&&M.value.trim()==="N/A"?(q.textContent="Grade is required",q.style.display="block",M.classList.add("error"),!1):(q.textContent="",q.style.display="none",M.classList.remove("error"),!0)}M&&M.addEventListener("blur",V);var j=document.getElementById("ethnicityInput"),f=document.getElementById("ethnicityError");function Z(){return j.hasAttribute("required")&&j.value.trim()===""?(f.textContent="Ethnicity is required",f.style.display="block",j.classList.add("error"),!1):(f.textContent="",f.style.display="none",f.classList.remove("error"),!0)}f&&j.addEventListener("blur",Z);var H=document.getElementById("healthInput"),P=document.getElementById("healthError");function Q(){return H.hasAttribute("required")&&H.value.trim()===""?(P.textContent="This field is required",P.style.display="block",H.classList.add("error"),!1):(P.textContent="",P.style.display="none",H.classList.remove("error"),!0)}H&&H.addEventListener("blur",Q);var x=document.getElementById("emergencyContact"),O=document.getElementById("emergencyError");function X(){return x.hasAttribute("required")&&x.value.trim()===""?(O.textContent="This field is required",O.style.display="block",x.classList.add("error"),!1):(O.textContent="",O.style.display="none",x.classList.remove("error"),!0)}x&&x.addEventListener("blur",X);var B=document.getElementById("dismissal"),R=document.getElementById("dismissalError");function K(){return B.hasAttribute("required")&&B.value.trim()===""?(R.textContent="This field is required",R.style.display="block",B.classList.add("error"),!1):(R.textContent="",R.style.display="none",B.classList.remove("error"),!0)}B&&B.addEventListener("blur",K);var u=document.getElementById("additionalEmail"),I=document.getElementById("additionalEmailError");function Y(){let e=/^\S+@\S+\.\S+$/;return u.hasAttribute("required")&&u.value.trim()===""?(I.textContent="Email is required",I.style.display="block",u.classList.add("error"),!1):u.value.trim()!==""&&!e.test(u.value)?(I.textContent="Please enter a valid email",I.style.display="block",u.classList.add("error"),!1):(I.textContent="",I.style.display="none",u.classList.remove("error"),!0)}u&&u.addEventListener("blur",Y);var D=document.getElementById("interestInput"),$=document.getElementById("interestError");function Le(){return D.hasAttribute("required")&&D.value.trim()===""?($.textContent="This field is required",$.style.display="block",D.classList.add("error"),!1):($.textContent="",$.style.display="none",D.classList.remove("error"),!0)}D&&D.addEventListener("blur",Le);async function se(){let e=localStorage.getItem("studentID"),t=localStorage.getItem("profile");if(!t||!e)return;let a=JSON.parse(t),{userID:s}=a,c=document.getElementById("loadingAnimation");c.style.display="block";let o={firstName:document.getElementById("firstNameInput").value,lastName:document.getElementById("lastNameInput").value,email:document.getElementById("emailInput").value,phone:document.getElementById("phoneInput").value,dob:document.getElementById("dobInput").value,gender:document.getElementById("genderInput").value,ethnicity:document.getElementById("ethnicityInput").value,health:document.getElementById("healthInput").value,additionalName:document.getElementById("additionalName").value,additionalEmail:document.getElementById("additionalEmail").value,additionalPhone:document.getElementById("additionalPhone").value,emergencyContact:document.getElementById("emergencyContact").value,dismissal:document.getElementById("dismissal").value,family:document.getElementById("family").value,grade:document.getElementById("gradeInput").value,school:document.getElementById("schoolInput").value,sendTexts:document.getElementById("sendTexts").checked,photoRelease:document.getElementById("photoRelease").checked,independentTravel:document.getElementById("independentTravel").checked,studentID:e,guardianUserID:s};try{let i=await fetch(`https://x8ki-letl-twmt.n7.xano.io/api:2gnTJ2I8/student_profiles/${e}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(i.ok){let n=await i.json(),l=document.getElementById("submitError");l.style.display="none";let r=document.getElementById("successMessage");r.style.display="flex";let E=document.getElementById("addStudentContainer");E.style.display="none",window.scrollTo(0,0);let p=document.getElementById("studentName");p.textContent=`${n.studentProfile.firstName} ${n.studentProfile.lastName}`;let C=document.getElementById("studentEmail");C.textContent=n.studentProfile.email;let ee=document.getElementById("studentPhone");ee.textContent=n.studentProfile.phone;let he=document.getElementById("studentImage");n.studentProfile.image&&n.studentProfile.image.url&&(he.src=n.studentProfile.image.url)}else{let n=await i.json(),l=document.getElementById("submitError");l&&(n.message==="Duplicate record detected. Please check your input and try again."?l.textContent="A user with that email already exists. If your student doesn\u2019t have their own email, please leave blank":l.textContent=n.message||"An error occurred",l.style.display="block",c.style.display="none")}}catch(i){console.error(i)}}ne();function ve(e){function t(r,E){let p=document.getElementById(r);if(p){if(p.tagName==="INPUT"||p.tagName==="TEXTAREA")p.value=E;else if(p.tagName==="SELECT"){let C=Array.from(p.options).find(ee=>ee.value===E);C&&(C.selected=!0)}}}t("firstNameInput",e.firstName),t("lastNameInput",e.lastName),t("phoneInput",e.phone),t("emailInput",e.email),t("dobInput",e.dob),t("schoolInput",e.school),t("gradeInput",e.grade),t("genderInput",e.gender),t("ethnicityInput",e.ethnicity),t("healthInput",e.health),t("emergencyContact",e.emergencyContact),t("dismissal",e.dismissal),["photoRelease","independentTravel","sendTexts"].forEach(r=>{let E=document.getElementById(r);E&&(E.checked=e[r])}),t("family",e.family),t("additionalName",e.additionalName),t("additionalEmail",e.additionalEmail),t("additionalPhone",e.additionalPhone);let s=document.getElementById("studentName");if(s){let r=`${e.firstName} ${e.lastName}`;s.textContent=r}let c=document.getElementById("profileImage");e.image&&e.image.url?c.src=e.image.url:c.src="https://uploads-ssl.webflow.com/64404db37a2b832b7d5aa9f8/64713ce0d5227bcec70c5505_360_F_542361185_VFRJWpR2FH5OiAEVveWO7oZnfSccZfD3.jpg";let o=document.getElementById("additionalCare"),i=document.getElementById("additionalOverflow");o&&i&&(o.checked=!!e.additionalName||!!e.additionalEmail||!!e.additionalPhone,i.style.height=o.checked?"32rem":"0",o.addEventListener("click",()=>{i.style.height=o.checked?"32rem":"0"}));let n=document.getElementById("familyToggle"),l=document.getElementById("familyOverflow");n&&l&&(n.checked=!!e.family,l.style.height=n.checked?"12rem":"0",n.addEventListener("click",()=>{l.style.height=n.checked?"12rem":"0"})),e.id&&localStorage.setItem("studentID",String(e.id))}window.addEventListener("load",()=>{let t=new URLSearchParams(window.location.search).get("student");t?fetch("https://x8ki-letl-twmt.n7.xano.io/api:2gnTJ2I8/getStudentProfile",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({airtableID:t})}).then(s=>s.json()).then(s=>{ve(s)}).catch(s=>{console.error("Error fetching data:",s)}):console.error("Missing airtableID parameter in the URL")});var Te=document.getElementById("imageUpload");ae(Te);var ie=document.getElementById("firstNameInput");ie&&ie.addEventListener("input",U);var re=document.getElementById("lastNameInput");re&&re.addEventListener("input",J);var oe=document.getElementById("emailInput");oe&&oe.addEventListener("input",F);var de=document.getElementById("phoneInput");de&&de.addEventListener("input",G);var me=document.getElementById("dobInput");me&&me.addEventListener("input",_);var ue=document.getElementById("genderInput");ue&&ue.addEventListener("input",z);var ce=document.getElementById("schoolInput");ce&&ce.addEventListener("input",W);var pe=document.getElementById("gradeInput");pe&&pe.addEventListener("input",V);var Ee=document.getElementById("ethnicityInput");Ee&&Ee.addEventListener("input",Z);var ge=document.getElementById("healthInput");ge&&ge.addEventListener("input",Q);var ye=document.getElementById("emergencyContact");ye&&ye.addEventListener("input",X);var Ie=document.getElementById("dismissal");Ie&&Ie.addEventListener("input",K);var fe=document.getElementById("additionalEmail");fe&&fe.addEventListener("input",Y);var te=document.getElementById("submitButton");te==null||te.addEventListener("click",e=>{if(!U()||!J()||!F()||!G()||!_()||!z()||!W()||!V()||!Z()||!Q()||!X()||!K()||!Y()){e.preventDefault();let t=document.getElementById("submitError");t&&(t.style.display="block",t.textContent="Please make sure you have entered all fields correctly.")}else e.preventDefault(),se()});})();
