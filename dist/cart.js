"use strict";(()=>{function w(){let t=localStorage.getItem("profile");if(t){let{userID:n}=JSON.parse(t);return n}return null}async function T(){let t=w();if(!t)return window.location.href="/login",[];let n=`https://xszy-vp96-kdkh.n7c.xano.io/api:2gnTJ2I8/cart_items?userID=${t}`,s=document.getElementById("cartLoading");s&&(s.style.display="block");let r=document.getElementById("noItems");r&&(r.style.display="none");try{let l=await fetch(n);if(!l.ok)throw new Error("Unable to fetch cart items.");let e=await l.json();if(e.length===0&&r){r.style.display="flex";let o=document.getElementById("submitButton");o&&(o.style.display="none")}return e}catch(l){return console.error(l),[]}finally{s&&(s.style.display="none")}}function D(t){let n=document.getElementById("cartList");if(!n){console.error("Cart list element not found.");return}n.innerHTML="";let s=document.getElementById("cartItem");if(!s){console.error("Cart item template not found.");return}s.remove();let r=0;t.forEach(e=>{let o=s.cloneNode(!0),y=o.querySelector("#programName");y.textContent=e.program;let p=o.querySelector("#workshopName");p.textContent=e.workshop;let c=o.querySelector("#sessionDay");c.textContent=e.sessionDay;let f=o.querySelector("#sessionTime");f.textContent=e.sessionTime;let g=o.querySelector("#unitPrice");g.textContent=`$${e.unitAmount.toFixed(2)}`;let m=o.querySelector("#depositBadge"),i=o.querySelector("#finAidBadge"),a=o.querySelector("#paymentPlanBadge"),d=o.querySelector("#removeFromCart");m.style.display=e.depositOnly?"block":"none",i.style.display=e.finAid?"block":"none",a.style.display=e.finPlan?"block":"none",d.style.backgroundColor=e.color,d.setAttribute("data-item-id",e.id),d.addEventListener("click",async h=>{h.preventDefault();let k=h.currentTarget.getAttribute("data-item-id");k&&await v(k)}),e.finAid&&(i.style.backgroundColor=e.color,i.style.display="block"),e.finPlan&&(a.style.backgroundColor=e.color,a.style.display="block"),e.depositOnly&&(m.style.backgroundColor=e.color,m.style.display="block");let u=Number(e.unitAmount)*Number(e.quantity),I=o.querySelector("#studentNames");I.textContent=e.studentNames.join(", ");let b=o.querySelector("#untitTotal");b.textContent=`$${u.toFixed(2)}`,r+=u;let E=o.querySelector("#cartImage");e.imageURL?E.src=e.imageURL:E.style.display="none",n.appendChild(o)});let l=document.getElementById("subtotal");l?l.textContent=`$${r.toFixed(2)}`:console.error("Subtotal element not found.")}async function v(t){let n=`https://xszy-vp96-kdkh.n7c.xano.io/api:2gnTJ2I8/cart_items/${t}`;try{if(!(await fetch(n,{method:"DELETE"})).ok)throw new Error("Unable to remove item from the cart.");window.location.reload()}catch(s){console.error(s)}}var C=document.querySelectorAll(".remove-cart-item");C.forEach(t=>{t.addEventListener("click",async n=>{n.preventDefault();let s=n.currentTarget.getAttribute("data-item-id");s&&await v(s)})});window.onload=async()=>{let t=document.getElementById("cartLoading");t&&(t.style.display="block");try{let n=await T();D(n)}catch(n){console.error(n)}finally{setTimeout(()=>{t&&(t.style.display="none")},1e3)}};async function S(t){let n=t.map((a,d)=>({price:a.priceID,quantity:a.quantity})),s=JSON.parse(localStorage.getItem("profile")||""),{id:r,userID:l,firstName:e,lastName:o,email:y,phoneNumber:p,image:c}=s,f={id:r,userID:l,firstName:e,lastName:o,email:y,phoneNumber:p,image:(c==null?void 0:c.url)||"",checkoutCategory:"registration"},g={line_items:n,mode:"payment",success_url:"https://chickenshed.webflow.io/successful-checkout",cancel_url:window.location.href,metadata:f},m="https://xszy-vp96-kdkh.n7c.xano.io/api:lRsgmoHt/sessions",i=document.getElementById("checkoutLoadingAnimation");i&&(i.style.display="block");try{let a=await fetch(m,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(g)});if(!a.ok)throw new Error("Unable to create checkout session.");let u=(await a.json()).url;window.location.href=u}catch(a){console.error(a)}finally{setTimeout(()=>{i&&(i.style.display="none")},1e3)}}var L;(L=document.querySelector("#submitButton"))==null||L.addEventListener("click",async function(){let t=document.getElementById("checkoutLoadingAnimation");t&&(t.style.display="block");try{let n=await T();await S(n)}catch(n){console.error(n)}finally{t&&(t.style.display="none")}});})();
