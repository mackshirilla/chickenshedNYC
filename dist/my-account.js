"use strict";(()=>{function ne(){let e=localStorage.getItem("authToken");return e?fetch("https://x8ki-letl-twmt.n7.xano.io/api:WyQO-hFi/auth/me",{method:"GET",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}}).then(t=>{if(!t.ok)throw new Error("Network response was not ok");return t.json()}).catch(t=>{console.error("Error:",t);let n=document.querySelector(".page-wrapper");n&&n.hasAttribute("gatedContent")&&(window.location.href="/login",localStorage.removeItem("authToken"),localStorage.removeItem("profile"),localStorage.removeItem("role"))}):(window.location.href="/login",Promise.reject())}function se(){let e=localStorage.getItem("profile");if(!e)return Promise.reject(new Error("Profile not found in localStorage"));let n=JSON.parse(e).id;if(!n)return Promise.reject(new Error("Guardian ID not found in profile"));let u=`https://x8ki-letl-twmt.n7.xano.io/api:2gnTJ2I8/guardians/${n}`;return fetch(u,{method:"GET",headers:{"Content-Type":"application/json"}}).then(s=>{if(!s.ok)throw new Error("Network response was not ok");return s.json()}).then(s=>{var y,p,C,Q,Z,K,V,X,ee,te;let r=document.getElementById("firstNameInput");r.value=(y=s.firstName)!=null?y:"";let a=document.getElementById("lastNameInput");a.value=(p=s.lastName)!=null?p:"";let l=document.getElementById("phoneInput");l.value=(C=s.phoneNumber)!=null?C:"";let d=document.getElementById("emailInput");d.value=(Q=s.email)!=null?Q:"";let o=document.getElementById("sendTexts");o.checked=(Z=s.sendTexts)!=null?Z:!1;let i=document.getElementById("yMember");i.checked=s.yMembership!==void 0&&s.yMembership!=="";let c=document.getElementById("membershipNumber");c.value=(K=s.yMembership)!=null?K:"";let m=document.getElementById("profileImage");return m.src=(X=(V=s.image)==null?void 0:V.url)!=null?X:"https://assets.website-files.com/64404db37a2b832b7d5aa9f8/64404db37a2b831d465aaa01_image.svg",m.alt=`${(ee=s.firstName)!=null?ee:""} ${(te=s.lastName)!=null?te:""}'s profile picture`,s}).catch(s=>{throw console.error("Error:",s),s})}async function oe(){let e=localStorage.getItem("profile"),t=e?JSON.parse(e):null,n=t?t.id:null;if(!n)return;let u=document.getElementById("loadingAnimation"),s=document.getElementById("firstNameInput"),r=document.getElementById("lastNameInput"),a=document.getElementById("emailInput"),l=document.getElementById("phoneInput"),d=document.getElementById("sendTexts"),o=document.getElementById("yMember"),i=document.getElementById("membershipNumber");if(u&&s&&r&&a&&l&&d&&o&&i){u.style.display="block";let c={firstName:s.value,lastName:r.value,email:a.value,phone:l.value,sendTexts:d.checked,isYMember:o.checked,membershipNumber:i.value,guardianID:n};try{let m=await fetch(`https://x8ki-letl-twmt.n7.xano.io/api:2gnTJ2I8/guardians/${n}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)});if(m.ok)window.location.reload();else{let y=await m.json(),p=document.getElementById("submitError");p&&(p.style.display="block",p.textContent=y.message),u&&(u.style.display="none")}}catch(m){console.error(m)}finally{u&&(u.style.display="none")}}}function re(e){e.addEventListener("change",async()=>{var a;let t=document.getElementById("profileImage"),n=document.getElementById("fileError"),u=document.getElementById("fileUploaded"),s=document.getElementById("loadingImageAnimation"),r=(a=e.files)==null?void 0:a[0];if(r){if(r.size>2*1024*1024){n.textContent="File size must be less than 2MB",n.style.display="block";return}let l=new FileReader;l.onload=async()=>{t.src=l.result,n.textContent="",n.style.display="none",s.style.display="flex";try{let d=localStorage.getItem("profile"),o=d?JSON.parse(d):null,i=o?o.id:null,c=await fetch("https://x8ki-letl-twmt.n7.xano.io/api:2gnTJ2I8/guardianImages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({guardianID:i,guardianImage:l.result})});if(c.ok)u.style.display="block";else throw new Error(`Error: ${c.status} ${c.statusText}`)}catch(d){n.textContent=d.message,n.style.display="block"}finally{s.style.display="none"}},l.readAsDataURL(r)}else t.src="https://assets.website-files.com/64404db37a2b832b7d5aa9f8/64404db37a2b831d465aaa01_image.svg",n.textContent="",n.style.display="none"})}var v=document.getElementById("firstNameInput"),w=document.getElementById("firstNameError");function z(){return v.hasAttribute("required")&&v.value.trim()===""?(w.textContent="First name required",w.style.display="block",v.classList.add("error"),!1):(w.textContent="",w.style.display="none",v.classList.remove("error"),!0)}v&&v.addEventListener("blur",z);var b=document.getElementById("lastNameInput"),P=document.getElementById("lastNameError");function W(){return b.hasAttribute("required")&&b.value.trim()===""?(P.textContent="Last name required",P.style.display="block",b.classList.add("error"),!1):(P.textContent="",P.style.display="none",b.classList.remove("error"),!0)}b&&b.addEventListener("blur",W);var g=document.getElementById("emailInput"),I=document.getElementById("emailError");function Y(){let e=/^\S+@\S+\.\S+$/;return g.hasAttribute("required")&&g.value.trim()===""?(I.textContent="Email is required",I.style.display="block",g.classList.add("error"),!1):g.value.trim()!==""&&!e.test(g.value)?(I.textContent="Please enter a valid email",I.style.display="block",g.classList.add("error"),!1):(I.textContent="",I.style.display="none",g.classList.remove("error"),!0)}g&&g.addEventListener("blur",Y);var f=document.getElementById("phoneInput"),h=document.getElementById("phoneError");function ae(e){let t=e.replace(/\D/g,"");return t.length===0?"":t.length<4?`(${t}`:t.length<7?`(${t.slice(0,3)}) ${t.slice(3)}`:`(${t.slice(0,3)}) ${t.slice(3,6)}-${t.slice(6,10)}`}function F(){let e=/^\D*(\d{3})\D*\D*(\d{3})\D*(\d{4})\D*$/;return f.required&&f.value.trim()===""?(h.textContent="Phone is required",h.style.display="block",f.classList.add("error"),!1):f.value.trim()!==""&&!e.test(f.value)?(h.textContent="Please enter a valid phone number",h.style.display="block",f.classList.add("error"),!1):(f.value=ae(f.value),h.textContent="",h.style.display="none",f.classList.remove("error"),!0)}f&&f.addEventListener("input",e=>{let t=e.target;t.value=ae(t.value),F()});var x=document.getElementById("dobInput"),q=document.getElementById("dobError");function ge(){return x.hasAttribute("required")&&x.value.trim()===""?(q.textContent="Date of Birth is required",q.style.display="block",x.classList.add("error"),!1):(q.textContent="",q.style.display="none",x.classList.remove("error"),!0)}x&&x.addEventListener("blur",ge);var M=document.getElementById("genderInput"),A=document.getElementById("genderError");function Ee(){return M.hasAttribute("required")&&M.value.trim()===""?(A.textContent="Gender is required",A.style.display="block",M.classList.add("error"),!1):(A.textContent="",A.style.display="none",M.classList.remove("error"),!0)}M&&M.addEventListener("blur",Ee);var B=document.getElementById("schoolInput"),O=document.getElementById("schoolError");function Ie(){return B.hasAttribute("required")&&B.value.trim()===""?(O.textContent="School name is required",O.style.display="block",B.classList.add("error"),!1):(O.textContent="",O.style.display="none",B.classList.remove("error"),!0)}B&&B.addEventListener("blur",Ie);var H=document.getElementById("gradeInput"),j=document.getElementById("gradeError");function he(){return H.hasAttribute("required")&&H.value.trim()==="N/A"?(j.textContent="Grade is required",j.style.display="block",H.classList.add("error"),!1):(j.textContent="",j.style.display="none",H.classList.remove("error"),!0)}H&&H.addEventListener("blur",he);var U=document.getElementById("ethnicityInput"),T=document.getElementById("ethnicityError");function Le(){return U.hasAttribute("required")&&U.value.trim()===""?(T.textContent="Ethnicity is required",T.style.display="block",U.classList.add("error"),!1):(T.textContent="",T.style.display="none",T.classList.remove("error"),!0)}T&&U.addEventListener("blur",Le);var k=document.getElementById("healthInput"),J=document.getElementById("healthError");function Te(){return k.hasAttribute("required")&&k.value.trim()===""?(J.textContent="This field is required",J.style.display="block",k.classList.add("error"),!1):(J.textContent="",J.style.display="none",k.classList.remove("error"),!0)}k&&k.addEventListener("blur",Te);var S=document.getElementById("emergencyContact"),$=document.getElementById("emergencyError");function ve(){return S.hasAttribute("required")&&S.value.trim()===""?($.textContent="This field is required",$.style.display="block",S.classList.add("error"),!1):($.textContent="",$.style.display="none",S.classList.remove("error"),!0)}S&&S.addEventListener("blur",ve);var D=document.getElementById("dismissal"),R=document.getElementById("dismissalError");function be(){return D.hasAttribute("required")&&D.value.trim()===""?(R.textContent="This field is required",R.style.display="block",D.classList.add("error"),!1):(R.textContent="",R.style.display="none",D.classList.remove("error"),!0)}D&&D.addEventListener("blur",be);var E=document.getElementById("additionalEmail"),L=document.getElementById("additionalEmailError");function xe(){let e=/^\S+@\S+\.\S+$/;return E.hasAttribute("required")&&E.value.trim()===""?(L.textContent="Email is required",L.style.display="block",E.classList.add("error"),!1):E.value.trim()!==""&&!e.test(E.value)?(L.textContent="Please enter a valid email",L.style.display="block",E.classList.add("error"),!1):(L.textContent="",L.style.display="none",E.classList.remove("error"),!0)}E&&E.addEventListener("blur",xe);var N=document.getElementById("interestInput"),G=document.getElementById("interestError");function Me(){return N.hasAttribute("required")&&N.value.trim()===""?(G.textContent="This field is required",G.style.display="block",N.classList.add("error"),!1):(G.textContent="",G.style.display="none",N.classList.remove("error"),!0)}N&&N.addEventListener("blur",Me);async function le(){let e=localStorage.getItem("profile"),t=e?JSON.parse(e):null,n=t?t.userID:null;if(!n)return;let u=document.getElementById("loadingAnimation"),s=document.getElementById("studentList"),r=document.getElementById("noStudents");try{u.style.display="block";let a=await fetch(`https://x8ki-letl-twmt.n7.xano.io/api:2gnTJ2I8/student_profiles?guardianUserID=${n}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(a.ok){let l=await a.json();if(l.allStudentProfiles.length>0){s.innerHTML="";let d=document.getElementById("studentCard");l.allStudentProfiles.forEach(o=>{let i=d.cloneNode(!0),c=i.querySelector("#studentNameList"),m=i.querySelector("#studentEmailList"),y=i.querySelector("#studentPhoneList"),p=i.querySelector("#studentImageList");c&&(c.textContent=o.firstName+" "+o.lastName),m&&(m.textContent=o.email),y&&(y.textContent=o.phone),p&&o.image&&(p.src=o.image.url),i.href=`/my-account/student-profile?student=${o.airtableID}`,s.append(i)}),d.style.display="none",s.style.display="grid",r.style.display="none"}else s.style.display="none",r.style.display="flex"}else{let l=await a.json();alert(l.message||"An error occurred")}}catch(a){console.error(a)}finally{u.style.display="none"}}function ie(){let e=localStorage.getItem("profile");if(!e){console.error("Profile object not found in localStorage.");return}let t=JSON.parse(e),{airtableID:n}=t;if(!n){console.error("Airtable ID not found in profile.");return}let s=`https://x8ki-letl-twmt.n7.xano.io/api:2gnTJ2I8/Ticket_Orders?${new URLSearchParams({userAirtableID:n})}`;fetch(s,{method:"GET",headers:{"Content-Type":"application/json"}}).then(r=>r.json()).then(r=>{if(console.log("Response:",r),!r.response||!r.response.result||!r.response.result.records){console.error("Unable to find ticket order records in the response.");return}let{records:a}=r.response.result,l=document.getElementById("ticketList");if(l)if(l.innerHTML="",a.length===0){let d=document.getElementById("noTickets");d&&(d.style.display="flex")}else{let d=document.getElementById("noTickets");d&&(d.style.display="none"),a.forEach(o=>{let i=document.createElement("a");i.href=`/tickets/ticket-order?order=${o.fields.orderNumber}`,i.setAttribute("data-w-id","6f59b974-64ae-1e7f-09cb-d5a59bc81f77"),i.className="student_card w-inline-block";let c=document.createElement("div");c.className="student_details",c.setAttribute("w-el","studentCard");let m=document.createElement("div");m.id="performanceName",m.className="heading-style-h6",m.textContent=o.fields.performanceName;let y=document.createElement("div");y.id="performanceDate",y.className="text-weight-light text-size-small",y.textContent=Be(o.fields.performanceDate);let p=document.createElement("div");p.id="performanceTime",p.className="text-weight-light text-size-small",p.textContent=o.fields.performanceTime,c.appendChild(m),c.appendChild(y),c.appendChild(p),i.appendChild(c),l.appendChild(i)})}}).catch(r=>{console.error("Error:",r)})}function Be(e){let t={year:"numeric",month:"long",day:"numeric",timeZone:"UTC"};return new Date(e).toLocaleDateString(void 0,t)}function de(){let e=localStorage.getItem("profile"),t=localStorage.getItem("role"),n=e?JSON.parse(e).id:null;if(!n){console.error('ID not found in the "profile" object in localStorage. Make sure the "profile" object is set properly.');return}let u="https://x8ki-letl-twmt.n7.xano.io/api:2gnTJ2I8/Get_Files",r={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:n,role:t})},a=document.getElementById("fileListWrapper"),l=document.getElementById("noFiles"),d=document.getElementById("fileItem");if(!a||!l||!d){console.error("Some DOM elements couldn't be found.");return}fetch(u,r).then(o=>o.json()).then(o=>{console.log("Response:",o);let i=document.getElementById("loadingWall");i&&(i.style.display="none"),Array.isArray(o)&&o.length>0?(a.innerHTML="",o.forEach(c=>{let m=c[0];if(m&&m.name&&m.filelink){let y=d.cloneNode(!0),p=y.querySelector("#fileName");p&&(p.textContent=m.name);let C=y.querySelector("#fileLink");C&&(C.href=m.filelink),a.appendChild(y)}}),a.style.display="grid",l.style.display="none"):(a.style.display="none",l.style.display="block")}).catch(o=>{console.error("Error:",o)})}ne();var He=localStorage.getItem("role");He==="student"&&(window.location.href="/student-dashboard");var ke=document.querySelectorAll('.switch input[type="checkbox"]');ke.forEach(function(e){e.addEventListener("click",function(){let t=this.parentNode;t.classList.toggle("checked");let n=t.querySelector(".toggle-text");n&&(this.checked?n.textContent="Yes":n.textContent="No")}),e.click()});se().then(()=>{let e=document.querySelector("#yMember");e!=null&&e.checked?_("7rem"):_("0rem"),e==null||e.addEventListener("change",function(){this.checked?_("7rem"):_("0rem")})}).catch(e=>{console.error(e)});function _(e){let t=document.querySelector("#displayYInput");t&&(t.style.height=e)}var Se=document.getElementById("imageUpload");re(Se);var me=document.getElementById("phoneInput");me&&me.addEventListener("input",F);var ce=document.getElementById("firstNameInput");ce&&ce.addEventListener("input",z);var ue=document.getElementById("lastNameInput");ue&&ue.addEventListener("input",W);var pe=document.getElementById("emailInput");pe&&pe.addEventListener("input",Y);var De=document.getElementById("submitButton");De.addEventListener("click",e=>{if(F())e.preventDefault(),oe();else{e.preventDefault();let t=document.getElementById("submitError");t.style.display="block",t.textContent="Please make sure you have entered all fields correctly."}});le();var ye=document.getElementById("addStudent");ye&&ye.addEventListener("click",()=>{localStorage.setItem("redirectURL",window.location.href)});ie();de();var fe=document.getElementById("deleteAccount");fe&&fe.addEventListener("click",()=>{let e=JSON.parse(localStorage.getItem("profile")),{userID:t}=e;fetch("https://x8ki-letl-twmt.n7.xano.io/api:2gnTJ2I8/Delete_Account",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userID:t})}).then(n=>{n.status===200&&(window.location.href="/login")}).catch(n=>{console.error(n)})});})();
