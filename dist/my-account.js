"use strict";(()=>{function ne(){let e=localStorage.getItem("authToken");return e?fetch("https://x8ki-letl-twmt.n7.xano.io/api:WyQO-hFi/auth/me",{method:"GET",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}}).then(t=>{if(!t.ok)throw new Error("Network response was not ok");return t.json()}).catch(t=>{console.error("Error:",t);let s=document.querySelector(".page-wrapper");s&&s.hasAttribute("gatedContent")&&(window.location.href="/login",localStorage.removeItem("authToken"),localStorage.removeItem("profile"),localStorage.removeItem("role"))}):(window.location.href="/login",Promise.reject())}function se(){let e=localStorage.getItem("profile");if(!e)return Promise.reject(new Error("Profile not found in localStorage"));let s=JSON.parse(e).id;if(!s)return Promise.reject(new Error("Guardian ID not found in profile"));let u=`https://x8ki-letl-twmt.n7.xano.io/api:2gnTJ2I8/guardians/${s}`;return fetch(u,{method:"GET",headers:{"Content-Type":"application/json"}}).then(n=>{if(!n.ok)throw new Error("Network response was not ok");return n.json()}).then(n=>{var y,p,C,Q,Z,K,V,X,ee,te;let o=document.getElementById("firstNameInput");o.value=(y=n.firstName)!=null?y:"";let a=document.getElementById("lastNameInput");a.value=(p=n.lastName)!=null?p:"";let l=document.getElementById("phoneInput");l.value=(C=n.phoneNumber)!=null?C:"";let d=document.getElementById("emailInput");d.value=(Q=n.email)!=null?Q:"";let r=document.getElementById("sendTexts");r.checked=(Z=n.sendTexts)!=null?Z:!1;let i=document.getElementById("yMember");i.checked=n.yMembership!==void 0&&n.yMembership!=="";let c=document.getElementById("membershipNumber");c.value=(K=n.yMembership)!=null?K:"";let m=document.getElementById("profileImage");return m.src=(X=(V=n.image)==null?void 0:V.url)!=null?X:"https://assets.website-files.com/64404db37a2b832b7d5aa9f8/64404db37a2b831d465aaa01_image.svg",m.alt=`${(ee=n.firstName)!=null?ee:""} ${(te=n.lastName)!=null?te:""}'s profile picture`,n}).catch(n=>{throw console.error("Error:",n),n})}async function re(){let e=localStorage.getItem("profile"),t=e?JSON.parse(e):null,s=t?t.id:null;if(!s)return;let u=document.getElementById("loadingAnimation"),n=document.getElementById("firstNameInput"),o=document.getElementById("lastNameInput"),a=document.getElementById("emailInput"),l=document.getElementById("phoneInput"),d=document.getElementById("sendTexts"),r=document.getElementById("yMember"),i=document.getElementById("membershipNumber");if(u&&n&&o&&a&&l&&d&&r&&i){u.style.display="block";let c={firstName:n.value,lastName:o.value,email:a.value,phone:l.value,sendTexts:d.checked,isYMember:r.checked,membershipNumber:i.value,guardianID:s};try{let m=await fetch(`https://x8ki-letl-twmt.n7.xano.io/api:2gnTJ2I8/guardians/${s}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)});if(m.ok)window.location.reload();else{let y=await m.json(),p=document.getElementById("submitError");p&&(p.style.display="block",p.textContent=y.message),u&&(u.style.display="none")}}catch(m){console.error(m)}finally{u&&(u.style.display="none")}}}function oe(e){e.addEventListener("change",async()=>{var a;let t=document.getElementById("profileImage"),s=document.getElementById("fileError"),u=document.getElementById("fileUploaded"),n=document.getElementById("loadingImageAnimation"),o=(a=e.files)==null?void 0:a[0];if(o){if(o.size>2*1024*1024){s.textContent="File size must be less than 2MB",s.style.display="block";return}let l=new FileReader;l.onload=async()=>{t.src=l.result,s.textContent="",s.style.display="none",n.style.display="flex";try{let d=localStorage.getItem("profile"),r=d?JSON.parse(d):null,i=r?r.id:null,c=await fetch("https://x8ki-letl-twmt.n7.xano.io/api:2gnTJ2I8/guardianImages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({guardianID:i,guardianImage:l.result})});if(c.ok)u.style.display="block";else throw new Error(`Error: ${c.status} ${c.statusText}`)}catch(d){s.textContent=d.message,s.style.display="block"}finally{n.style.display="none"}},l.readAsDataURL(o)}else t.src="https://assets.website-files.com/64404db37a2b832b7d5aa9f8/64404db37a2b831d465aaa01_image.svg",s.textContent="",s.style.display="none"})}var v=document.getElementById("firstNameInput"),w=document.getElementById("firstNameError");function z(){return v.hasAttribute("required")&&v.value.trim()===""?(w.textContent="First name required",w.style.display="block",v.classList.add("error"),!1):(w.textContent="",w.style.display="none",v.classList.remove("error"),!0)}v&&v.addEventListener("blur",z);var b=document.getElementById("lastNameInput"),P=document.getElementById("lastNameError");function W(){return b.hasAttribute("required")&&b.value.trim()===""?(P.textContent="Last name required",P.style.display="block",b.classList.add("error"),!1):(P.textContent="",P.style.display="none",b.classList.remove("error"),!0)}b&&b.addEventListener("blur",W);var g=document.getElementById("emailInput"),I=document.getElementById("emailError");function Y(){let e=/^\S+@\S+\.\S+$/;return g.hasAttribute("required")&&g.value.trim()===""?(I.textContent="Email is required",I.style.display="block",g.classList.add("error"),!1):g.value.trim()!==""&&!e.test(g.value)?(I.textContent="Please enter a valid email",I.style.display="block",g.classList.add("error"),!1):(I.textContent="",I.style.display="none",g.classList.remove("error"),!0)}g&&g.addEventListener("blur",Y);var f=document.getElementById("phoneInput"),h=document.getElementById("phoneError");function ae(e){let t=e.replace(/\D/g,"");return t.length===0?"":t.length<4?`(${t}`:t.length<7?`(${t.slice(0,3)}) ${t.slice(3)}`:`(${t.slice(0,3)}) ${t.slice(3,6)}-${t.slice(6,10)}`}function F(){let e=/^\D*(\d{3})\D*\D*(\d{3})\D*(\d{4})\D*$/;return f.required&&f.value.trim()===""?(h.textContent="Phone is required",h.style.display="block",f.classList.add("error"),!1):f.value.trim()!==""&&!e.test(f.value)?(h.textContent="Please enter a valid phone number",h.style.display="block",f.classList.add("error"),!1):(f.value=ae(f.value),h.textContent="",h.style.display="none",f.classList.remove("error"),!0)}f&&f.addEventListener("input",e=>{let t=e.target;t.value=ae(t.value),F()});var x=document.getElementById("dobInput"),q=document.getElementById("dobError");function fe(){return x.hasAttribute("required")&&x.value.trim()===""?(q.textContent="Date of Birth is required",q.style.display="block",x.classList.add("error"),!1):(q.textContent="",q.style.display="none",x.classList.remove("error"),!0)}x&&x.addEventListener("blur",fe);var M=document.getElementById("genderInput"),A=document.getElementById("genderError");function ge(){return M.hasAttribute("required")&&M.value.trim()===""?(A.textContent="Gender is required",A.style.display="block",M.classList.add("error"),!1):(A.textContent="",A.style.display="none",M.classList.remove("error"),!0)}M&&M.addEventListener("blur",ge);var B=document.getElementById("schoolInput"),O=document.getElementById("schoolError");function Ee(){return B.hasAttribute("required")&&B.value.trim()===""?(O.textContent="School name is required",O.style.display="block",B.classList.add("error"),!1):(O.textContent="",O.style.display="none",B.classList.remove("error"),!0)}B&&B.addEventListener("blur",Ee);var H=document.getElementById("gradeInput"),j=document.getElementById("gradeError");function Ie(){return H.hasAttribute("required")&&H.value.trim()==="N/A"?(j.textContent="Grade is required",j.style.display="block",H.classList.add("error"),!1):(j.textContent="",j.style.display="none",H.classList.remove("error"),!0)}H&&H.addEventListener("blur",Ie);var U=document.getElementById("ethnicityInput"),T=document.getElementById("ethnicityError");function he(){return U.hasAttribute("required")&&U.value.trim()===""?(T.textContent="Ethnicity is required",T.style.display="block",U.classList.add("error"),!1):(T.textContent="",T.style.display="none",T.classList.remove("error"),!0)}T&&U.addEventListener("blur",he);var k=document.getElementById("healthInput"),J=document.getElementById("healthError");function Le(){return k.hasAttribute("required")&&k.value.trim()===""?(J.textContent="This field is required",J.style.display="block",k.classList.add("error"),!1):(J.textContent="",J.style.display="none",k.classList.remove("error"),!0)}k&&k.addEventListener("blur",Le);var D=document.getElementById("emergencyContact"),$=document.getElementById("emergencyError");function Te(){return D.hasAttribute("required")&&D.value.trim()===""?($.textContent="This field is required",$.style.display="block",D.classList.add("error"),!1):($.textContent="",$.style.display="none",D.classList.remove("error"),!0)}D&&D.addEventListener("blur",Te);var N=document.getElementById("dismissal"),R=document.getElementById("dismissalError");function ve(){return N.hasAttribute("required")&&N.value.trim()===""?(R.textContent="This field is required",R.style.display="block",N.classList.add("error"),!1):(R.textContent="",R.style.display="none",N.classList.remove("error"),!0)}N&&N.addEventListener("blur",ve);var E=document.getElementById("additionalEmail"),L=document.getElementById("additionalEmailError");function be(){let e=/^\S+@\S+\.\S+$/;return E.hasAttribute("required")&&E.value.trim()===""?(L.textContent="Email is required",L.style.display="block",E.classList.add("error"),!1):E.value.trim()!==""&&!e.test(E.value)?(L.textContent="Please enter a valid email",L.style.display="block",E.classList.add("error"),!1):(L.textContent="",L.style.display="none",E.classList.remove("error"),!0)}E&&E.addEventListener("blur",be);var S=document.getElementById("interestInput"),G=document.getElementById("interestError");function xe(){return S.hasAttribute("required")&&S.value.trim()===""?(G.textContent="This field is required",G.style.display="block",S.classList.add("error"),!1):(G.textContent="",G.style.display="none",S.classList.remove("error"),!0)}S&&S.addEventListener("blur",xe);async function le(){let e=localStorage.getItem("profile"),t=e?JSON.parse(e):null,s=t?t.userID:null;if(!s)return;let u=document.getElementById("loadingAnimation"),n=document.getElementById("studentList"),o=document.getElementById("noStudents");try{u.style.display="block";let a=await fetch(`https://x8ki-letl-twmt.n7.xano.io/api:2gnTJ2I8/student_profiles?guardianUserID=${s}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(a.ok){let l=await a.json();if(l.allStudentProfiles.length>0){n.innerHTML="";let d=document.getElementById("studentCard");l.allStudentProfiles.forEach(r=>{let i=d.cloneNode(!0),c=i.querySelector("#studentNameList"),m=i.querySelector("#studentEmailList"),y=i.querySelector("#studentPhoneList"),p=i.querySelector("#studentImageList");c&&(c.textContent=r.firstName+" "+r.lastName),m&&(m.textContent=r.email),y&&(y.textContent=r.phone),p&&r.image&&(p.src=r.image.url),i.href=`/my-account/student-profile?student=${r.airtableID}`,n.append(i)}),d.style.display="none",n.style.display="grid",o.style.display="none"}else n.style.display="none",o.style.display="flex"}else{let l=await a.json();alert(l.message||"An error occurred")}}catch(a){console.error(a)}finally{u.style.display="none"}}function ie(){let e=localStorage.getItem("profile");if(!e){console.error("Profile object not found in localStorage.");return}let t=JSON.parse(e),{airtableID:s}=t;if(!s){console.error("Airtable ID not found in profile.");return}let n=`https://x8ki-letl-twmt.n7.xano.io/api:2gnTJ2I8/Ticket_Orders?${new URLSearchParams({userAirtableID:s})}`;fetch(n,{method:"GET",headers:{"Content-Type":"application/json"}}).then(o=>o.json()).then(o=>{if(console.log("Response:",o),!o.response||!o.response.result||!o.response.result.records){console.error("Unable to find ticket order records in the response.");return}let{records:a}=o.response.result,l=document.getElementById("ticketList");if(l)if(l.innerHTML="",a.length===0){let d=document.getElementById("noTickets");d&&(d.style.display="flex")}else{let d=document.getElementById("noTickets");d&&(d.style.display="none"),a.forEach(r=>{let i=document.createElement("a");i.href=`/tickets/ticket-order?order=${r.fields.orderNumber}`,i.setAttribute("data-w-id","6f59b974-64ae-1e7f-09cb-d5a59bc81f77"),i.className="student_card w-inline-block";let c=document.createElement("div");c.className="student_details",c.setAttribute("w-el","studentCard");let m=document.createElement("div");m.id="performanceName",m.className="heading-style-h6",m.textContent=r.fields.performanceName;let y=document.createElement("div");y.id="performanceDate",y.className="text-weight-light text-size-small",y.textContent=Me(r.fields.performanceDate);let p=document.createElement("div");p.id="performanceTime",p.className="text-weight-light text-size-small",p.textContent=r.fields.performanceTime,c.appendChild(m),c.appendChild(y),c.appendChild(p),i.appendChild(c),l.appendChild(i)})}}).catch(o=>{console.error("Error:",o)})}function Me(e){let t={year:"numeric",month:"long",day:"numeric",timeZone:"UTC"};return new Date(e).toLocaleDateString(void 0,t)}function de(){let e=localStorage.getItem("profile"),t=localStorage.getItem("role"),s=e?JSON.parse(e).id:null;if(!s){console.error('ID not found in the "profile" object in localStorage. Make sure the "profile" object is set properly.');return}let u="https://x8ki-letl-twmt.n7.xano.io/api:2gnTJ2I8/Get_Files",o={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:s,role:t})},a=document.getElementById("fileListWrapper"),l=document.getElementById("noFiles"),d=document.getElementById("fileItem");if(!a||!l||!d){console.error("Some DOM elements couldn't be found.");return}fetch(u,o).then(r=>r.json()).then(r=>{console.log("Response:",r);let i=document.getElementById("loadingWall");i&&(i.style.display="none"),Array.isArray(r)&&r.length>0?(a.innerHTML="",r.forEach(c=>{let m=c[0];if(m&&m.name&&m.filelink){let y=d.cloneNode(!0),p=y.querySelector("#fileName");p&&(p.textContent=m.name);let C=y.querySelector("#fileLink");C&&(C.href=m.filelink),a.appendChild(y)}}),a.style.display="grid",l.style.display="none"):(a.style.display="none",l.style.display="block")}).catch(r=>{console.error("Error:",r)})}ne();var Be=localStorage.getItem("role");Be==="student"&&(window.location.href="/student-dashboard");var He=document.querySelectorAll('.switch input[type="checkbox"]');He.forEach(function(e){e.addEventListener("click",function(){let t=this.parentNode;t.classList.toggle("checked");let s=t.querySelector(".toggle-text");s&&(this.checked?s.textContent="Yes":s.textContent="No")}),e.click()});se().then(()=>{let e=document.querySelector("#yMember");e!=null&&e.checked?_("7rem"):_("0rem"),e==null||e.addEventListener("change",function(){this.checked?_("7rem"):_("0rem")})}).catch(e=>{console.error(e)});function _(e){let t=document.querySelector("#displayYInput");t&&(t.style.height=e)}var ke=document.getElementById("imageUpload");oe(ke);var me=document.getElementById("phoneInput");me&&me.addEventListener("input",F);var ce=document.getElementById("firstNameInput");ce&&ce.addEventListener("input",z);var ue=document.getElementById("lastNameInput");ue&&ue.addEventListener("input",W);var pe=document.getElementById("emailInput");pe&&pe.addEventListener("input",Y);var De=document.getElementById("submitButton");De.addEventListener("click",e=>{if(F())e.preventDefault(),re();else{e.preventDefault();let t=document.getElementById("submitError");t.style.display="block",t.textContent="Please make sure you have entered all fields correctly."}});le();var ye=document.getElementById("addStudent");ye&&ye.addEventListener("click",()=>{localStorage.setItem("redirectURL",window.location.href)});ie();de();})();
